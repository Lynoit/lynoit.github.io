<!DOCTYPE html>
<html>
<head>
    <title>KPI -- Annotator</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        table { width: 100%; margin: 10px 0; }
        td, th { text-align: center; padding: 10px; }
        #leftColumn1, #leftColumn2 { vertical-align: top; }
        .bigButton { display: block; width: 50%; padding: 1px; font-size: 12px; border-radius: 3px; cursor: pointer; margin: 5px auto; }
        .orangeButton { background-color: orange; color: white; }
        .blueButton   { background-color: blue;   color: white; }
        .greyButton   { background-color: grey;   color: white; }
        .greenButton  { background-color: green;  color: white; }
        .redButton    { background-color: red;    color: white; }
        /* full‑width overrides */
        #textBox { width: 100%; margin: 0 auto; }
        .fullWidthControl { width: 100% !important; }
        .distanceContainer { display: flex; justify-content: space-between; align-items: center; }
        .weatherSection { display: flex; align-items: center; justify-content: center; }
        .weatherSection img { width: 24px; height: 24px; margin-right: 5px; }
        #map { height: 300px; width: 100%; }
        @media print { .bigButton, #textBox { display: none !important; } }
        .issue-label { background: rgba(255,255,255,0.8); padding: 2px 4px; border-radius: 3px; font-size: 12px; color: #333; white-space: nowrap; pointer-events: none; }
        #countContainer { width: 80%; max-width: 800px; margin: 20px auto; text-align: center; }
        #countTable { width: 100%; border: 1px solid #333; border-collapse: collapse; margin: 0 auto; }
        #countTable td, #countTable th { border: 1px solid #333; }
        /* Layout for map and charts and table */
        #mapContainer { width: 100%; padding: 0; box-sizing: border-box; }
        #chartsContainer { display: flex; width: 100%; box-sizing: border-box; margin-top: 20px; }
        .chartBox, .tableBox { flex: 1; padding: 0 10px; }
        .chartBox canvas { width: 100%; height: 300px; }
        #streetTable { width: 100%; border: 1px solid #333; border-collapse: collapse; margin-top: 10px; }
        #streetTable td { border: 1px solid #333; }
        footer { text-align: center; padding: 10px; font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <table>
        <tr>
            <td>
                <p id="dateTime"></p>
                <div class="weatherSection">
                    <img id="weatherIcon" src="" alt="Weather icon">
                    <p id="temperature">Temp: N/A</p>
                </div>
            </td>
            <td><p id="streetCity">Street: N/A<br>City: N/A</p></td>
            <td><p id="location"></p></td>
            <td><p id="roadType">Road type: N/A</p></td>
            <td><p id="speed">Speed: N/A</p></td>
            <td>
                <div class="distanceContainer">
                    <p id="totalDistance">Distance: 0.0 km</p>
                    <button type="button" class="bigButton orangeButton" onclick="resetDistance()">Reset distance</button>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <textarea id="textBox" rows="1" placeholder="Enter your annotation here..."></textarea>
            </td>
            <td>
                <button type="button"
                        class="bigButton blueButton fullWidthControl"
                        onclick="logButton('Manual annotation', false)">
                  Manual annotation
                </button>
            </td>
            <td>
                <button type="button"
                        class="bigButton greenButton fullWidthControl"
                        onclick="saveAndPrint()">
                  Save report to pdf
                </button>
            </td>
            <td colspan="3"></td>
        </tr>
        <tr>
            <td id="leftColumn1">
                <button type="button" class="bigButton greyButton">ACC</button>
                <button type="button" class="bigButton redButton" onclick="logButton('ACC False brake', true)">False brake</button>
                <button type="button" class="bigButton redButton" onclick="logButton('ACC Target drop', true)">Target drop</button>
                <button type="button" class="bigButton redButton" onclick="logButton('ACC Longitudinal jerk', true)">Longitudinal jerk</button>
                <button type="button" class="bigButton redButton" onclick="logButton('ACC Accuracy in speed adaption', true)">Accuracy in speed adaption</button>
            </td>
            <td colspan="5"></td>
            <td id="leftColumn2">
                <button type="button" class="bigButton greyButton">TSI Speed</button>
                <button type="button" class="bigButton greenButton" onclick="logButton('TSI Explicit correct speed detected', false)">Correct explicit speed detected</button>
                <button type="button" class="bigButton redButton" onclick="logButton('TSI Explicit incorrect speed detected', true)">Incorrect explicit speed detected</button>
            </td>
        </tr>
    </table>

    <div id="logTableContainer"></div>

    <br><hr><br>
    <div id="mapContainer">
        <h3 style="text-align:center;">Route</h3>
        <div id="map"></div>
    </div>
    <br><hr><br>
    <div id="chartsContainer">
        <div class="chartBox">
            <h3 style="text-align:center;">Distance vs Time</h3>
            <canvas id="distanceChart"></canvas>
        </div>
        <div class="chartBox">
            <h3 style="text-align:center;">Speed vs Distance</h3>
            <canvas id="speedChart"></canvas>
        </div>
        <div class="tableBox">
            <h3 style="text-align:center;">Streets Encountered</h3>
            <table id="streetTable"></table>
        </div>
    </div>
    <br><hr><br>

    <div id="countContainer">
        <h3>KPI Calculation</h3>
        <table id="countTable">
            <tr><th>Issue</th><th>Total No of events</th><th>Events per 1000 km</th></tr>
            <tr><td colspan="3">&nbsp;</td></tr>
        </table>
    </div>

    <!-- Dependencies -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        /* (all your existing JS remains unchanged) */
    </script>

    <footer>
      © Lynoit Tech 2025
    </footer>
</body>
</html>
