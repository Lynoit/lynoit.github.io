<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Retro Weather & News Dashboard</title>
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
 <style>
   :root { --bg:#0d0d0d; --text:#00ff9d; --accent:#ff007c; }
   body {
     margin:0; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:start;
     background:var(--bg); color:var(--text); font-family:'Press Start 2P',monospace; overflow:hidden;
   }
   body::before{content:"";position:fixed;top:0;left:0;width:100%;height:100%;background-image:repeating-linear-gradient(0deg,rgba(255,255,255,.05),rgba(255,255,255,.05)2px,transparent 2px,transparent 4px);pointer-events:none;mix-blend-mode:overlay;}
   h1{font-size:1.2rem;margin-top:1rem;}
   #location{margin-top:.5rem;font-size:.8rem;color:var(--accent);}
   /* flip clock */
   .clock{display:flex;margin-top:2rem;}
   .digit{perspective:1000px;margin:0 2px;}
   .digit .card{position:relative;width:48px;height:60px;background:#222;border-radius:4px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.8);}
   .digit .card div{height:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;}
   .digit .upper{border-bottom:1px solid #000;}
   .digit .lower{position:absolute;top:50%;left:0;right:0;transform-origin:top;}
   .flip .upper{animation:fold .5s ease-in forwards;}
   .flip .lower{animation:unfold .5s .5s ease-out forwards;}
   @keyframes fold{0%{transform:rotateX(0);}100%{transform:rotateX(-90deg);}}
   @keyframes unfold{0%{transform:rotateX(90deg);}100%{transform:rotateX(0);}}
   /* sections */
   #weather,#forecast,#pollen,#news{margin-top:1.5rem;text-align:center;font-size:.8rem;}
   .small{font-size:.7rem;opacity:.8;}
   a{color:var(--accent);text-decoration:none;} a:hover{text-decoration:underline;}
 </style>
</head>
<body>
 <h1>Retro Dashboard</h1>
 <div id="location">Locating...</div>
 <div id="clock" class="clock"></div>
 <div id="weather"><h2>Current Weather</h2><div id="weatherData">Loading...</div></div>
 <div id="forecast"><h2>Next 48 h Forecast</h2><div id="forecastData">Loading...</div></div>
 <div id="pollen"><h2>Pollen</h2><div id="pollenData">Loading...</div></div>
 <div id="news"><h2>Top News (SE)</h2><div id="newsData">Loading...</div></div>

<script>
/**************** Flip Clock ****************/ 
function createDigit(v){const d=document.createElement('div');d.className='digit';d.innerHTML=`<div class="card" data-value="${v}"><div class="upper">${v}</div><div class="lower">${v}</div></div>`;return d;}
function updateCard(card,nv){const cv=card.dataset.value;if(cv===nv)return;const u=card.querySelector('.upper'),l=card.querySelector('.lower');l.textContent=nv;card.classList.add('flip');setTimeout(()=>{card.dataset.value=nv;u.textContent=nv;card.classList.remove('flip');},900);} 
function setupClock(){const cl=document.getElementById('clock');for(let i=0;i<6;i++){cl.appendChild(createDigit('0'));if(i===1||i===3)cl.appendChild(document.createTextNode(':'));}tick();setInterval(tick,1000);} 
function tick(){const n=new Date(),ts=n.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit',second:'2-digit'}),cards=document.querySelectorAll('.digit .card');let j=0;for(let i=0;i<ts.length;i++){const ch=ts[i];if(ch!==':'){updateCard(cards[j],ch);j++;}}}

/**************** Geolocation + init ****************/ 
let lat,lon;window.onload=function(){setupClock();if(navigator.geolocation){navigator.geolocation.getCurrentPosition(p=>{lat=p.coords.latitude.toFixed(2);lon=p.coords.longitude.toFixed(2);document.getElementById('location').textContent=`${lat}, ${lon}`;getWeather();getPollen();},()=>{document.getElementById('location').textContent='Location denied';});}getNews();};

/**************** WeatherAPI ****************/ 
const WEATHER_KEY='ad8caecea06c43d1912181938230407';
async function getWeather(){if(!lat||!lon)return;const query=`${lat},${lon}`;const url=`https://api.weatherapi.com/v1/forecast.json?key=${WEATHER_KEY}&q=${query}&days=3&aqi=no&alerts=no`;try{const r=await fetch(url);const w=await r.json();const cur=w.current;const temp=cur.temp_c;const windDir=cur.wind_dir;const windSpeed=(cur.wind_kph/3.6).toFixed(1);const precip=cur.precip_mm;document.getElementById('weatherData').innerHTML=`<div>${temp} °C</div><div>Wind: ${windDir} / ${windSpeed} m/s</div><div>Precip: ${precip} mm</div>`;let fhtml='';for(let i=1;i<=2;i++){const fd=w.forecast.forecastday[i];if(!fd)continue;const date=new Date(fd.date).toLocaleDateString([], {weekday:'short'});const t=fd.day.avgtemp_c;const p=fd.day.totalprecip_mm;fhtml+=`<div class="small">${date}: ${t}°C, ${p} mm</div>`;}document.getElementById('forecastData').innerHTML=fhtml;}catch(e){document.getElementById('weatherData').textContent='Weather unavailable';}}

/**************** SMHI Pollen ****************/ 
async function getPollen(){const url='https://opendata.smhi.se/api/category/pollen/version/1/station/latest';try{const r=await fetch(url);const d=await r.json();const val=d.value||'n/a';const dt=new Date(d.referenceTime||Date.now()).toLocaleDateString();document.getElementById('pollenData').textContent=`${val} (updated ${dt})`; }catch(e){document.getElementById('pollenData').textContent='Pollen data unavailable';}}

/**************** NewsAPI ****************/ 
const NEWS_KEY='YOUR_NEWSAPI_KEY';
async function getNews(){if(!NEWS_KEY){document.getElementById('newsData').textContent='Add NewsAPI key';return;}const url=`https://newsapi.org/v2/top-headlines?country=se&pageSize=1&apiKey=${NEWS_KEY}`;try{const r=await fetch(url);const d=await r.json();if(d.articles&&d.articles.length){const a=d.articles[0];document.getElementById('newsData').innerHTML=`<a href="${a.url}" target="_blank">${a.title}</a>`;}}catch(e){document.getElementById('newsData').textContent='News unavailable';}}
</script>
</body>
</html>
