<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reseräkning – skapa PDF med underlag</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 16px; background:#fafafa; }
    h1 { margin: 0 0 12px; }
    .grid { display: grid; gap: 12px; }
    .card { background:#fff; border:1px solid #ddd; border-radius: 10px; padding: 12px; }
    .row { display:flex; gap: 10px; flex-wrap: wrap; }
    label { display:flex; flex-direction: column; font-size: 12px; gap: 6px; }
    input, textarea, select, button { font: inherit; }
    input, textarea, select { padding: 8px; border:1px solid #ccc; border-radius:8px; min-width: 220px; }
    textarea { min-height: 60px; min-width: 320px; }
    table { width:100%; border-collapse: collapse; }
    th, td { border:1px solid #ddd; padding: 8px; text-align: left; }
    th { background:#f3f3f3; }
    .muted { color:#666; font-size: 12px; }
    .right { text-align: right; }
    .actions { display:flex; gap: 10px; flex-wrap: wrap; align-items:center; }
    .btn { padding: 10px 14px; border-radius: 10px; border:1px solid #222; background:#222; color:#fff; cursor:pointer; }
    .btn.secondary { background:#fff; color:#222; }
    .btn.danger { background:#b00020; border-color:#b00020; }
    .totals { display:flex; gap: 20px; flex-wrap: wrap; justify-content: flex-end; }
    .totals .box { min-width: 260px; border:1px solid #ddd; border-radius: 10px; padding: 10px; background:#fff; }
    .totals .box div { display:flex; justify-content: space-between; padding: 4px 0; }
    .small { font-size: 12px; }
    .item-controls { display:flex; gap: 8px; }
    .preview { display:flex; gap:10px; flex-wrap:wrap; margin-top: 8px; }
    .pill { display:inline-flex; gap:6px; align-items:center; border:1px solid #ddd; background:#fff; border-radius: 999px; padding: 6px 10px; font-size: 12px; }
  </style>

  <!-- jsPDF + autotable -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- pdf.js (för att rendera uppladdade PDF-underlag till bilder som kan läggas in i den färdiga PDF:en) -->
  <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.10.38/build/pdf.min.js"></script>
</head>

<body>
  <h1>Reseräkning</h1>
  <div class="muted">Lägg till poster och ladda upp underlag. Klicka sedan <b>Skapa PDF</b>.</div>

  <div class="grid" style="margin-top:12px;">

    <div class="card">
      <h2 style="margin:0 0 10px;">1) Uppgifter (förstasidan)</h2>

      <div class="row">
        <label>Datum
          <input id="date" type="date">
        </label>
        <label>Kund nr
          <input id="kundNr" placeholder="t.ex. 2">
        </label>
        <label>Faktura nr
          <input id="fakturaNr" placeholder="t.ex. 0079">
        </label>
        <label>Betalningsvillkor (dagar)
          <input id="betalningsvillkor" type="number" value="45" min="0">
        </label>
        <label>Moms (%)
          <input id="vatRate" type="number" value="25" min="0" step="0.1">
        </label>
      </div>

      <div class="row" style="margin-top:10px;">
        <label style="flex:1; min-width:320px;">Kund (namn + adress)
          <textarea id="kundAdress" placeholder="t.ex. Sigma Technology Embedded Solutions AB&#10;FE5908&#10;838 77 Frösön"></textarea>
        </label>
        <label style="min-width:260px;">Er referens
          <input id="erRef" placeholder="t.ex. Martin Karlsson">
        </label>
        <label style="min-width:260px;">Vår referens
          <input id="varRef" placeholder="t.ex. Thomas Lyngfelt">
        </label>
        <label style="min-width:260px;">Personnummer / ID
          <input id="pnr" placeholder="t.ex. 740815-4990">
        </label>
      </div>

      <div class="row" style="margin-top:10px;">
        <label>Projekt / uppdragsgivare (nr)
          <input id="projektNr" placeholder="t.ex. 212972">
        </label>
        <label>Projekt / uppdragsgivare (namn)
          <input id="projektNamn" placeholder="t.ex. Zeekr Technology Europe">
        </label>
      </div>

      <div class="row" style="margin-top:10px;">
        <label style="flex:1; min-width:320px;">Avsändare (företag + adress)
          <textarea id="avsandareAdress" placeholder="t.ex. Lynoit Tech AB&#10;Björkkullavägen 47&#10;42470 Olofstorp"></textarea>
        </label>
        <label>Org.nr
          <input id="orgNr" placeholder="t.ex. 559229-0752">
        </label>
        <label>Moms/regnr
          <input id="momsRegnr" placeholder="t.ex. SE559229075201">
        </label>
        <label>E-post
          <input id="email" placeholder="t.ex. thomas@lynoit.se">
        </label>
        <label>Telefon
          <input id="telefon" placeholder="t.ex. 0708-481916">
        </label>
        <label>Bankgiro
          <input id="bankgiro" placeholder="t.ex. 5416-0460">
        </label>
      </div>

      <div class="row" style="margin-top:10px;">
        <label>Logotyp (valfritt, PNG/JPG)
          <input id="logo" type="file" accept="image/*">
        </label>
        <div class="muted small" style="align-self:flex-end;">
          Om du vill matcha din mall mer: ladda upp loggan som ligger uppe till vänster i exemplet. :contentReference[oaicite:4]{index=4}
        </div>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 10px;">2) Utgiftsposter</h2>

      <div class="row">
        <label>Produktbeskrivning
          <input id="newDesc" placeholder="t.ex. Hotel Hirsch Leonberg">
        </label>
        <label>Antal
          <input id="newQty" type="number" value="1" min="0" step="1">
        </label>
        <label>Pris (kr)
          <input id="newUnit" type="number" value="0" min="0" step="0.01">
        </label>
        <label>Underlag
          <input id="newReceipt" type="file" accept="image/*,application/pdf">
        </label>
        <div style="align-self:flex-end;">
          <button class="btn secondary" id="addItemBtn" type="button">Lägg till post</button>
        </div>
      </div>

      <div class="muted small" style="margin-top:8px;">
        Varje post måste ha ett kvitto/underlag. Underlagen hamnar som separata sidor efter reseräkningen.
      </div>

      <div style="margin-top:12px; overflow:auto;">
        <table>
          <thead>
            <tr>
              <th style="min-width:260px;">Produktbeskrivning</th>
              <th style="width:90px;">Antal</th>
              <th style="width:120px;">Pris</th>
              <th style="width:120px;">Belopp</th>
              <th style="min-width:220px;">Underlag</th>
              <th style="width:160px;">Åtgärder</th>
            </tr>
          </thead>
          <tbody id="itemsTbody"></tbody>
        </table>
      </div>

      <div class="totals" style="margin-top:12px;">
        <div class="box">
          <div><span>Summa:</span><b id="summaOut">0 kr</b></div>
          <div><span>Moms:</span><b id="momsOut">0 kr</b></div>
          <div style="border-top:1px solid #eee; margin-top:6px; padding-top:6px;">
            <span>Att betala:</span><b id="attBetalaOut">0 kr</b>
          </div>
        </div>
      </div>

      <div class="actions" style="margin-top:12px;">
        <button class="btn" id="createPdfBtn" type="button">Skapa PDF</button>
        <button class="btn secondary" id="saveDraftBtn" type="button">Spara utkast (lokalt)</button>
        <button class="btn secondary" id="loadDraftBtn" type="button">Ladda utkast</button>
        <span class="muted small" id="status"></span>
      </div>
    </div>

  </div>

<script>
  // ---- pdf.js worker ----
  // (krävs för att PDF-underlag ska kunna renderas i browsern)
  if (window.pdfjsLib) {
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.10.38/build/pdf.worker.min.js";
  }

  const state = {
    header: {},
    items: [], // {desc, qty, unit, receiptFile: File}
    logoFile: null
  };

  const $ = (id) => document.getElementById(id);

  function formatKr(n) {
    const v = Number(n || 0);
    const rounded = Math.round(v * 100) / 100;
    return rounded.toLocaleString("sv-SE", { minimumFractionDigits: 0, maximumFractionDigits: 2 }) + " kr";
  }

  function recalcTotals() {
    const vatPct = Number($("vatRate").value || 0);
    const sum = state.items.reduce((acc, it) => acc + (Number(it.qty)||0) * (Number(it.unit)||0), 0);
    const moms = sum * (vatPct / 100);
    const total = sum + moms;
    $("summaOut").textContent = formatKr(sum);
    $("momsOut").textContent = formatKr(moms);
    $("attBetalaOut").textContent = formatKr(total);
    return { sum, moms, total, vatPct };
  }

  function setStatus(msg) { $("status").textContent = msg || ""; }

  function renderItemsTable() {
    const tbody = $("itemsTbody");
    tbody.innerHTML = "";

    state.items.forEach((it, idx) => {
      const tr = document.createElement("tr");

      const amount = (Number(it.qty)||0) * (Number(it.unit)||0);

      tr.innerHTML = `
        <td>${escapeHtml(it.desc)}</td>
        <td class="right">${escapeHtml(String(it.qty))}</td>
        <td class="right">${escapeHtml(formatKr(it.unit))}</td>
        <td class="right"><b>${escapeHtml(formatKr(amount))}</b></td>
        <td>
          <div class="preview">
            <span class="pill">${escapeHtml(it.receiptFile?.name || "—")}</span>
            <span class="pill">${escapeHtml(it.receiptFile?.type || "")}</span>
          </div>
        </td>
        <td>
          <div class="item-controls">
            <button class="btn secondary" data-action="up" data-idx="${idx}" type="button">↑</button>
            <button class="btn secondary" data-action="down" data-idx="${idx}" type="button">↓</button>
            <button class="btn danger" data-action="del" data-idx="${idx}" type="button">Ta bort</button>
          </div>
        </td>
      `;
      tbody.appendChild(tr);
    });

    recalcTotals();
  }

  function escapeHtml(s) {
    return String(s ?? "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  $("addItemBtn").addEventListener("click", () => {
    const desc = $("newDesc").value.trim();
    const qty = Number($("newQty").value || 0);
    const unit = Number($("newUnit").value || 0);
const receipt = $("newReceipt").files?.[0];

if (!desc) return alert("Skriv en produktbeskrivning.");

state.items.push({ desc, qty, unit, receiptFile: receipt || null });

    $("newDesc").value = "";
    $("newQty").value = 1;
    $("newUnit").value = 0;
    $("newReceipt").value = "";

    renderItemsTable();
  });

  $("itemsTbody").addEventListener("click", (e) => {
    const btn = e.target.closest("button");
    if (!btn) return;
    const idx = Number(btn.dataset.idx);
    const action = btn.dataset.action;
    if (!Number.isFinite(idx)) return;

    if (action === "del") {
      state.items.splice(idx, 1);
    } else if (action === "up" && idx > 0) {
      const tmp = state.items[idx-1];
      state.items[idx-1] = state.items[idx];
      state.items[idx] = tmp;
    } else if (action === "down" && idx < state.items.length - 1) {
      const tmp = state.items[idx+1];
      state.items[idx+1] = state.items[idx];
      state.items[idx] = tmp;
    }
    renderItemsTable();
  });

  $("vatRate").addEventListener("input", () => recalcTotals());

  $("logo").addEventListener("change", () => {
    state.logoFile = $("logo").files?.[0] || null;
  });

  // ---- Draft (utan att spara själva filerna) ----
  // Browsern tillåter inte att vi återställer File-objekt från localStorage.
  // Så draft sparar metadata + poster (utan kvittofil), men du får välja underlagen igen efter load.
  $("saveDraftBtn").addEventListener("click", () => {
    const draft = {
      header: readHeader(),
      items: state.items.map(it => ({ desc: it.desc, qty: it.qty, unit: it.unit }))
    };
    localStorage.setItem("reserakning_draft_v1", JSON.stringify(draft));
    setStatus("Utkast sparat lokalt (kvittofiler sparas ej).");
  });

  $("loadDraftBtn").addEventListener("click", () => {
    const raw = localStorage.getItem("reserakning_draft_v1");
    if (!raw) return alert("Inget sparat utkast hittades.");
    const draft = JSON.parse(raw);

    writeHeader(draft.header || {});
    state.items = (draft.items || []).map(it => ({ ...it, receiptFile: null }));

    // Markera att kvitton måste laddas upp igen
    renderItemsTable();
    setStatus("Utkast laddat. Ladda upp underlag på nytt för varje post.");
  });

  function readHeader() {
    return {
      date: $("date").value,
      kundNr: $("kundNr").value.trim(),
      fakturaNr: $("fakturaNr").value.trim(),
      betalningsvillkor: $("betalningsvillkor").value.trim(),
      vatRate: $("vatRate").value.trim(),
      kundAdress: $("kundAdress").value,
      erRef: $("erRef").value.trim(),
      varRef: $("varRef").value.trim(),
      pnr: $("pnr").value.trim(),
      projektNr: $("projektNr").value.trim(),
      projektNamn: $("projektNamn").value.trim(),
      avsandareAdress: $("avsandareAdress").value,
      orgNr: $("orgNr").value.trim(),
      momsRegnr: $("momsRegnr").value.trim(),
      email: $("email").value.trim(),
      telefon: $("telefon").value.trim(),
      bankgiro: $("bankgiro").value.trim(),
    };
  }

  function writeHeader(h) {
    $("date").value = h.date || "";
    $("kundNr").value = h.kundNr || "";
    $("fakturaNr").value = h.fakturaNr || "";
    $("betalningsvillkor").value = h.betalningsvillkor || "45";
    $("vatRate").value = h.vatRate || "25";
    $("kundAdress").value = h.kundAdress || "";
    $("erRef").value = h.erRef || "";
    $("varRef").value = h.varRef || "";
    $("pnr").value = h.pnr || "";
    $("projektNr").value = h.projektNr || "";
    $("projektNamn").value = h.projektNamn || "";
    $("avsandareAdress").value = h.avsandareAdress || "";
    $("orgNr").value = h.orgNr || "";
    $("momsRegnr").value = h.momsRegnr || "";
    $("email").value = h.email || "";
    $("telefon").value = h.telefon || "";
    $("bankgiro").value = h.bankgiro || "";
  }

  // ---- PDF generation ----
  $("createPdfBtn").addEventListener("click", async () => {
    setStatus("");
    const header = readHeader();

    if (!header.date) return alert("Fyll i datum.");
    if (state.items.length === 0) return alert("Lägg till minst en post.");

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: "mm", format: "a4" });
    const pageW = doc.internal.pageSize.getWidth();
    const pageH = doc.internal.pageSize.getHeight();
    const margin = 12;

    setStatus("Skapar PDF…");

    // --- Page 1: Reseräkning ---
    await drawFirstPage(doc, header, margin, pageW, pageH);

    // --- Underlag pages ---
for (let i = 0; i < state.items.length; i++) {
  const it = state.items[i];
  const file = it.receiptFile;

  // Inget underlag? Hoppa bara över.
  if (!file) continue;

  if (file.type === "application/pdf") {
    await appendPdfUnderlag(doc, file, margin, pageW, pageH, `Underlag: ${it.desc}`);
  } else if (file.type.startsWith("image/")) {
    await appendImageUnderlag(doc, file, margin, pageW, pageH, `Underlag: ${it.desc}`);
  } else {
    doc.addPage();
    doc.setFontSize(12);
    doc.text(`Underlag kunde inte tolkas: ${file.name}`, margin, margin + 10);
  }
}

    const safeDate = (header.date || "datum").replaceAll(":", "-");
    doc.save(`Reserakning_${safeDate}.pdf`);
    setStatus("Klart! PDF nedladdad.");
  });

  async function drawFirstPage(doc, h, margin, pageW, pageH) {
    const { sum, moms, total } = recalcTotals();
    const vatPct = Number(h.vatRate || 0);

    // Logo (valfritt)
    if (state.logoFile && state.logoFile.type.startsWith("image/")) {
      const logoDataUrl = await fileToDataUrl(state.logoFile);
      // Placering ungefär som i mallen (uppe till vänster) :contentReference[oaicite:5]{index=5}
      doc.addImage(logoDataUrl, "PNG", margin, margin, 55, 22, undefined, "FAST");
    }

    // Titel
    doc.setFontSize(20);
    doc.text("Reseräkning", pageW - margin, margin + 6, { align: "right" }); // rubrik :contentReference[oaicite:6]{index=6}

    // Datum/kund/faktura rad (höger)
    doc.setFontSize(10);
    const rightX = pageW - margin;
    const topY = margin + 14;
    doc.text(`Datum: ${h.date}`, rightX, topY, { align: "right" }); // :contentReference[oaicite:7]{index=7}
    doc.text(`Kund nr: ${h.kundNr || ""}`, rightX, topY + 5, { align: "right" }); // :contentReference[oaicite:8]{index=8}
    doc.text(`Faktura nr: ${h.fakturaNr || ""}`, rightX, topY + 10, { align: "right" }); // :contentReference[oaicite:9]{index=9}

    // Kundadress (vänster)
    doc.setFontSize(11);
    doc.text(splitLines(h.kundAdress || ""), margin, margin + 34);

    // Referenser + projekt
    doc.setFontSize(10);
    const refY = margin + 58;

    doc.text("Er referens", margin, refY);
    doc.text(h.erRef || "", margin, refY + 5); // :contentReference[oaicite:10]{index=10}

    doc.text("Vår referens", margin + 55, refY);
    doc.text(h.varRef || "", margin + 55, refY + 5); // :contentReference[oaicite:11]{index=11}
    doc.text(h.pnr || "", margin + 55, refY + 10); // :contentReference[oaicite:12]{index=12}

    doc.text("Projekt / uppdragsgivare", margin + 110, refY);
    doc.text(h.projektNr || "", margin + 110, refY + 5); // :contentReference[oaicite:13]{index=13}
    doc.text(h.projektNamn || "", margin + 110, refY + 10); // :contentReference[oaicite:14]{index=14}

    doc.text("Betalningsvillkor", pageW - margin, refY, { align: "right" });
    doc.text(`${h.betalningsvillkor || ""} dagar`, pageW - margin, refY + 5, { align: "right" }); // :contentReference[oaicite:15]{index=15}

    // Tabell med poster: Produktbeskrivning / Antal / Pris / Belopp :contentReference[oaicite:16]{index=16}
    const bodyRows = state.items.map(it => {
      const qty = Number(it.qty||0);
      const unit = Number(it.unit||0);
      const amount = qty * unit;
      return [
        it.desc,
        String(qty),
        formatKr(unit),
        formatKr(amount)
      ];
    });

    doc.autoTable({
      startY: margin + 78,
      head: [["Produktbeskrivning", "Antal", "Pris", "Belopp"]],
      body: bodyRows,
      styles: { fontSize: 10, cellPadding: 2.2 },
      headStyles: { fillColor: [240, 240, 240], textColor: 20 },
      columnStyles: {
        0: { cellWidth: 105 },
        1: { halign: "right", cellWidth: 18 },
        2: { halign: "right", cellWidth: 28 },
        3: { halign: "right", cellWidth: 28 }
      },
      margin: { left: margin, right: margin }
    });

    // Totalsruta nere till höger (Summa / Moms / Att betala) :contentReference[oaicite:17]{index=17}
    const tableEndY = doc.lastAutoTable.finalY || (margin + 120);
    const boxW = 70;
    const boxH = 28;
    const boxX = pageW - margin - boxW;
    const boxY = Math.min(pageH - margin - boxH - 25, tableEndY + 10);

    doc.setDrawColor(60);
    doc.rect(boxX, boxY, boxW, boxH);

    doc.setFontSize(10);
    doc.text("Summa:", boxX + 4, boxY + 8);
    doc.text(formatKr(sum), boxX + boxW - 4, boxY + 8, { align: "right" });

    doc.text(`Moms ${vatPct}%:`, boxX + 4, boxY + 16);
    doc.text(formatKr(moms), boxX + boxW - 4, boxY + 16, { align: "right" });

    doc.setFontSize(11);
    doc.text("Att betala:", boxX + 4, boxY + 25);
    doc.text(formatKr(total), boxX + boxW - 4, boxY + 25, { align: "right" });

    // Footer med avsändare
    doc.setFontSize(9);
    const footerY = pageH - margin - 12;
    doc.text(splitLines(h.avsandareAdress || ""), margin, footerY);

    const rightFooter = [
      `Org: ${h.orgNr || ""}`,
      `Moms/regnr: ${h.momsRegnr || ""}`,
      `E-post: ${h.email || ""}`,
      `Telefon: ${h.telefon || ""}`,
      `Bankgiro: ${h.bankgiro || ""}`
    ].filter(Boolean);

    doc.text(rightFooter, pageW - margin, footerY, { align: "right" });
  }

  function splitLines(text) {
    const t = String(text || "").trim();
    return t ? t.split(/\r?\n/).map(s => s.trim()).filter(Boolean) : [];
  }

  async function fileToDataUrl(file) {
    const buf = await file.arrayBuffer();
    const blob = new Blob([buf], { type: file.type });
    return await new Promise((resolve, reject) => {
      const r = new FileReader();
      r.onload = () => resolve(r.result);
      r.onerror = reject;
      r.readAsDataURL(blob);
    });
  }

  async function appendImageUnderlag(doc, file, margin, pageW, pageH, title) {
    const dataUrl = await fileToDataUrl(file);
    doc.addPage();
    doc.setFontSize(12);
    doc.text(title, margin, margin);

    // Best effort: lägg bilden så stor som möjligt på sidan
    const imgProps = doc.getImageProperties(dataUrl);
    const maxW = pageW - 2 * margin;
    const maxH = pageH - 2 * margin - 8;
    const ratio = Math.min(maxW / imgProps.width, maxH / imgProps.height);

    const w = imgProps.width * ratio;
    const h = imgProps.height * ratio;

    const x = (pageW - w) / 2;
    const y = margin + 6 + (maxH - h) / 2;

    doc.addImage(dataUrl, guessImageFormat(file.type), x, y, w, h, undefined, "FAST");
  }

  function guessImageFormat(mime) {
    if (mime.includes("png")) return "PNG";
    if (mime.includes("webp")) return "WEBP";
    return "JPEG";
  }

  async function appendPdfUnderlag(doc, file, margin, pageW, pageH, title) {
    if (!window.pdfjsLib) {
      doc.addPage();
      doc.setFontSize(12);
      doc.text("pdf.js saknas – kan inte rendera PDF-underlag.", margin, margin + 10);
      return;
    }

    const data = new Uint8Array(await file.arrayBuffer());
    const pdf = await pdfjsLib.getDocument({ data }).promise;

    for (let p = 1; p <= pdf.numPages; p++) {
      const page = await pdf.getPage(p);

      // rendera till canvas
      const viewport = page.getViewport({ scale: 2.0 });
      const canvas = document.createElement("canvas");
      const ctx = canvas.getContext("2d");
      canvas.width = viewport.width;
      canvas.height = viewport.height;

      await page.render({ canvasContext: ctx, viewport }).promise;
      const dataUrl = canvas.toDataURL("image/jpeg", 0.92);

      doc.addPage();
      doc.setFontSize(12);
      doc.text(`${title} (PDF sida ${p}/${pdf.numPages})`, margin, margin);

      // passa in på A4
      const maxW = pageW - 2 * margin;
      const maxH = pageH - 2 * margin - 8;

      // canvas px -> ratio; vi använder bara bildens proportioner
      const imgW = canvas.width;
      const imgH = canvas.height;

      const ratio = Math.min(maxW / imgW, maxH / imgH);
      const w = imgW * ratio;
      const h = imgH * ratio;

      const x = (pageW - w) / 2;
      const y = margin + 6 + (maxH - h) / 2;

      doc.addImage(dataUrl, "JPEG", x, y, w, h, undefined, "FAST");
    }
  }

  // Init defaults (valfritt)
  (function init() {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth()+1).padStart(2,"0");
    const dd = String(today.getDate()).padStart(2,"0");
    $("date").value = `${yyyy}-${mm}-${dd}`;

    // Om du vill förifylla med exempel från mallen:
    // (de syns bl.a. på första sidan i din PDF) :contentReference[oaicite:18]{index=18} :contentReference[oaicite:19]{index=19}
    // $("kundNr").value = "2";
    // $("fakturaNr").value = "0079";
    // $("kundAdress").value = "Sigma Technology Embedded Solutions AB\nFE5908\n838 77 Frösön";
    // $("erRef").value = "Martin Karlsson";
    // $("varRef").value = "Thomas Lyngfelt";
    // $("pnr").value = "740815-4990";
    // $("projektNr").value = "212972";
    // $("projektNamn").value = "Zeekr Technology Europe";
    // $("avsandareAdress").value = "Lynoit Tech AB\nBjörkkullavägen 47\n42470 Olofstorp";
    // $("orgNr").value = "559229-0752";
    // $("momsRegnr").value = "SE559229075201";
    // $("email").value = "thomas@lynoit.se";
    // $("telefon").value = "0708-481916";
    // $("bankgiro").value = "5416-0460";

    renderItemsTable();
  })();
</script>
</body>
</html>
