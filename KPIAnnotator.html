
<!DOCTYPE html>
<html>
<!-- ðŸ“File ðŸ’¬ https://github.com/JaewooJoung/markdown/edit/main/CEVT.html -->
<!-- ðŸ“™Brief ðŸ’¬ the page that works to test ADAS function quickly -->
<!-- ðŸ§¾Details ðŸ’¬ Also shows time, location, exact location, which type of road and record -->
<!-- ðŸš©OAuthor ðŸ’¬ Original Author: Jaewoo Joung/éƒ‘åœ¨ç¥(jaewoo.joung@outlook.com) -->
<!-- ðŸ‘¨â€ðŸ”§Company ðŸ’¬ Submited to: Myself in CEVT (jaewoo.joung@cevt.se) -->
<!-- ðŸ“†LastDate ðŸ’¬ 2023-07-07 ðŸ”„Please support to keep updateðŸ”„ -->
<!-- ðŸ­License ðŸ›‘ JSD:Just Simple Distribution (a License made by Jaewoo) -->
<!-- âœ…Guarantee ðŸ’¬ If you buy me a coffee, I will think about it -->
<head>
    <title>KPI -- Annotator</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        td {
            text-align: center;
            padding: 10px;
        }
        
        #leftColumn1 {
            text-align: center;
        }
         
        #leftColumn2 {
            text-align: center;
        }       
        
        #rightColumn {
            text-align: center;
        }
        
        .bigButton {
            display: block;
            width: 50%;
            padding: 1px 1px;
            font-size: 12px;
            border-radius: 1px;
            cursor: pointer;
        }
        
        .orangeButton {
            background-color: orange;
            color: white;
        }
        
        .redButton {
            background-color: red;
            color: white;
        }

        .blueButton {
            background-color: Blue;
            color: white;
        }

        .greyButton {
            background-color: Grey;
            color: white;
        }
       
        #radioButtonContainer {
            text-align: center;
        }
        
        #textBox {
            width: 30%;
            margin: 0 auto;
            padding: 10px;
            font-size: 18px;
            resize: vertical;
        }
    </style>
    <script>
        var logTable = [];

        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
            var speed = position.coords.speed || 0; // Use 0 if speed is not available

            document.getElementById("location").innerHTML = "Latitude: " + latitude + "<br>Longitude: " + longitude;
            document.getElementById("speed").innerHTML = "Speed: " + speed + " m/s";

            var url = "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" + latitude + "&lon=" + longitude;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    var city = data.address.city;
                    if (city) {
                        document.getElementById('city').innerHTML = 'City: ' + city;
                        getWeather(city); // Pass the city to the getWeather() function
                    } else {
                        document.getElementById('city').innerHTML = 'City not found';
                    }
                })
                .catch(error => {
                    document.getElementById('city').innerHTML = 'Error: ' + error.message;
                });
        }

        function showError(error) {
            document.getElementById("location").innerHTML = "Error: " + error.message;
            document.getElementById("speed").innerHTML = "Speed: N/A";
        }

        function updateLocation() {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        }

        setInterval(updateLocation, 1000); // update location every 1 minute (60 seconds)

        function getWeather(city) {
            // Make a request to the weather API to get the weather data
            // Replace 'YOUR_API_KEY' with your actual API key
            var weatherAPIUrl = 'https://api.weatherapi.com/v1/current.json?key=ad8caecea06c43d1912181938230407&q=' + encodeURIComponent(city);

            fetch(weatherAPIUrl)
                .then(response => response.json())
                .then(data => {
                    // Get the weather icon code from the API response
                    var weatherIcon = data.current.condition.icon;

                    // Create an <img> element for the weather icon
                    var weatherImg = document.createElement("img");
                    weatherImg.src = "https:" + weatherIcon;

                    // Append the weather icon to the weatherContainer div
                    var weatherContainer = document.getElementById("weatherContainer");
                    weatherContainer.innerHTML = ''; //Clear previous weather icon, if any
                    weatherContainer.appendChild(weatherImg);
                });
        }

        function handleMotion(event) {
            var speed = event.accelerationIncludingGravity && event.accelerationIncludingGravity.z || 0; // Use 0 if speed is not available
            document.getElementById("speed").innerHTML = "Speed: " + speed + " m/s";
        }

        window.addEventListener('devicemotion', handleMotion, true);

        function updateDateTime() {
            var currentDateTime = new Date().toLocaleString();
            document.getElementById("dateTime").innerHTML = currentDateTime;
        }

        setInterval(updateDateTime, 1000); // update date and time every second

        function handleLocationTypeChange() {
            var locationType = document.querySelector('input[name="locationType"]:checked').value;
            // Handle the selected location type here
        }

        function logButton(buttonName) {
            var date = new Date().toLocaleDateString();
            var time = new Date().toLocaleTimeString();
            var latitude = document.getElementById("location").innerHTML.split("<br>")[0].split(": ")[1];
            var longitude = document.getElementById("location").innerHTML.split("<br>")[1].split(": ")[1];
            var speed = document.getElementById("speed").innerHTML.split(": ")[1].split(" m/s")[0];
            var textBoxValue = document.getElementById("textBox").value;

            var logEntry = [buttonName, date, time, latitude, longitude, speed, textBoxValue];
            logTable.push(logEntry);

            displayLogTable();
        }

        function displayLogTable() {
            var logTableHTML = "<table><tr><th>No.</th><th>Issue</th><th>Date</th><th>Time</th><th>Latitude</th><th>Longitude</th><th>Speed</th><th>Comment</th></tr>";

            for (var i = logTable.length - 1; i >= 0; i--) {
                logTableHTML += "<tr>";
                logTableHTML += "<td>" + (i + 1) + "</td>";
                for (var j = 0; j < logTable[i].length; j++) {
                    logTableHTML += "<td>" + logTable[i][j] + ",</td>";
                }
                logTableHTML += "</tr>";
            }

            logTableHTML += "</table>";

            document.getElementById("logTableContainer").innerHTML = logTableHTML;
        }


        window.addEventListener('DOMContentLoaded', function () {
            var locationTypeRadios = document.querySelectorAll('input[name="locationType"]');
            locationTypeRadios.forEach(function (radio) {
                radio.addEventListener('change', handleLocationTypeChange, false);
            });
        });
    </script>
</head>
<body>
    <table>
        <tr>
            <td><p id="dateTime"></td>
            <td><p id="city">Locating...</td>
            <td><p id="location"></td>
            <td><p id="city">Locating...</p></td>
            <td><p id="speed">Speed: N/A</p></td>            
        </tr>
        <tr>
            <td><textarea id="textBox" style="width: 100%; margin: 0 auto;" rows="1" placeholder="Enter your annotation here..."></textarea>
            </td>
            <td>
            <button class="bigButton blueButton" onclick="logButton('Manual annotation')">Manual annotation</button>
            </td>
        </tr>
        <tr>
            <td id="leftColumn1">
                <button  class="bigButton greyButton"><br><br><br>ACC<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ACC False brake')"><br><br><br>False brake<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ACC Target drop')"><br><br><br>Target drop<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ACC Longitudinal jerk')"><br><br><br>Longitudinal jerk<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ACC Accuracy in speed adaption w/o lead vehicle not within 1-2 kph')"><br><br><br>ACC Accuracy in speed adaption<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ACC Accuracy in distance adaption to lead vehicle not within 0.25 s')"><br><br><br>Accuracy in distance adaption<br><br><br></button>
            </td>
            <td id="leftColumn2">
                <button  class="bigButton greyButton"><br><br><br>ALCA<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ALCA Not available within ODD')"><br><br><br>Not available within ODD<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ALCA Lane change jerk, smoothness not within 1 m/s3')"><br><br><br>Lane change jerk<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ALCA Lane change unmotivated cancellation')"><br><br><br>Lane change cancellation<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ALCA Lane change lateral speed more than 1 m/s')"><br><br><br>Lane change lateral speed too high<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('ALCA Number of trigs')"><br><br><br>Number of trigs<br><br><br></button>
            </td>
            <td id="leftColumn2">
                <button  class="bigButton greyButton"><br><br><br>LCC<br><br><br></button>
                <br>
                <button class="bigButton blueButton" onclick="logButton('LCC Not available within ODD')"><br><br><br>Not available within ODD<br><br><br></button>
            </td>            
            <td id="leftColumn2">
                <tr>
                <button  class="bigButton greyButton"><br><br><br>TSI Speed<br><br><br></button>
                </tr>
                <tr>
                <td>
                <button class="bigButton blueButton" onclick="logButton('TSI Explicit correct speed update')"><br><br><br>Correct explicit speed detected<br><br><br></button>
                </td>
                <td>
                <button class="bigButton blueButton" onclick="logButton('TSI Explicit incorrect speed update')"><br><br><br>Incorrect explicit speed detected<br><br><br></button>
                </td>
                </tr>
            </td> 
        </tr>
    </table>

    <div id="logTableContainer"></div>
</body>
</html>
