
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reverse Geocode Road Features Live Plots</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    #info { margin-bottom: 1em; font-size: 1em; }
    #currentFeatures {
      display: flex;
      flex-wrap: wrap;
      gap: 1em;
      margin-bottom: 1em;
    }
    .feature {
      display: flex;
      align-items: center;
      font-size: 1em;
    }
    .feature .icon {
      width: 28px;
      height: 28px;
      margin-right: 0.3em;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .feature .icon svg {
      width: 100%;
      height: 100%;
    }
    #map { height: 300px; width: 100%; margin-bottom: 2em; border: 1px solid #ccc; }
    .chart-container { width: 100%; max-width: 600px; margin-bottom: 2em; }
  </style>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Live Road Feature Tracking</h1>
  <div id="info">Locatingâ€¦</div>

  <!-- Current features display -->
  <div id="currentFeatures">
    <div class="feature">
      <span class="icon" id="icon-roadType">â“</span>
      <span class="label" id="label-roadType">Unknown</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-speed"></span>
      <span class="label" id="label-speed">N/A</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-roundabout">ğŸ”„</span>
      <span class="label" id="label-roundabout">No</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-stopSign">ğŸ›‘</span>
      <span class="label" id="label-stopSign">No</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-trafficLight">ğŸš¦</span>
      <span class="label" id="label-trafficLight">No</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-bridge">ğŸŒ‰</span>
      <span class="label" id="label-bridge">No</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-tunnel">ğŸ•³ï¸</span>
      <span class="label" id="label-tunnel">No</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-toll">ğŸ’°</span>
      <span class="label" id="label-toll">No</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-lanes">ğŸ›£ï¸</span>
      <span class="label" id="label-lanes">N/A</span>
    </div>
    <div class="feature">
      <span class="icon" id="icon-surface">â“</span>
      <span class="label" id="label-surface">Unknown</span>
    </div>
  </div>

  <div id="map"></div>

  <div id="charts">
    <!-- ... your existing chart canvases ... -->
    <div class="chart-container"><canvas id="speedChart"></canvas></div>
    <!-- etc. -->
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // â€¦ your data arrays, map setup, haversine, Chart.js init, etc. â€¦

    // Grab just the speed icon/label elements:
    const iconSpeed  = document.getElementById('icon-speed');
    const labelSpeed = document.getElementById('label-speed');

    // In your reverseGeocode() callback, replace the speed section with this:
    function drawSpeedSign(value) {
      if (isNaN(value)) {
        iconSpeed.innerHTML  = 'ğŸš«';
        labelSpeed.textContent = 'N/A';
      } else {
        // inline SVG circle + number
        iconSpeed.innerHTML = `
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <circle cx="50" cy="50" r="45" fill="#fff" stroke="#000" stroke-width="10"/>
            <text x="50" y="60" font-size="60" text-anchor="middle" font-family="Arial" fill="#000">
              ${value}
            </text>
          </svg>
        `;
        labelSpeed.textContent = `${value} km/h`;
      }
    }

    // Example usage inside reverseGeocode:
    function reverseGeocode(lat, lon) {
      // â€¦ after fetching data â€¦
      const tags = data.extratags || {};
      const maxSpeed = parseInt(tags.maxspeed, 10);
      drawSpeedSign(maxSpeed);

      // â€¦ then push into your arrays, update charts, etc. â€¦
    }

    // The rest of your code (watchPosition, updateCharts, etc.) stays the same.
  </script>
</body>
</html>
